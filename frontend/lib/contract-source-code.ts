export const tokenSourceCode = `// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/token/ERC20/extensions/ERC20Burnable.sol";
import "@openzeppelin/contracts/token/ERC20/extensions/ERC20Permit.sol";
import "@openzeppelin/contracts/token/ERC20/extensions/ERC20Votes.sol";

/// @custom:security-contact contact@agentswithbenefits.xyz
contract DAOToken is ERC20, ERC20Burnable, ERC20Permit, ERC20Votes {
    constructor(
        string memory _name,
        string memory _symbol,
        address _mintAddress,
        uint256 _totalSupply
    ) ERC20(_name, _symbol) ERC20Permit(_name) {
        _mint(_mintAddress, _totalSupply);
    }

    // The following functions are overrides required by Solidity.

    function _update(
        address from,
        address to,
        uint256 value
    ) internal override(ERC20, ERC20Votes) {
        super._update(from, to, value);
    }

    function nonces(
        address owner
    ) public view override(ERC20Permit, Nonces) returns (uint256) {
        return super.nonces(owner);
    }
}
`;

export const daoTokenByteCode = `0x608060405234801561001057600080fd5b50600436106101735760003560e01c806370a08231116100de57806395d89b4111610097578063c3cda52011610071578063c3cda5201461036e578063d505accf14610381578063dd62ed3e14610394578063f1127ed8146103cd57600080fd5b806395d89b41146103405780639ab24eb014610348578063a9059cbb1461035b57600080fd5b806370a08231146102a457806379cc6790146102cd5780637ecebe00146102e057806384b0196e146102f35780638e539e8c1461030e57806391ddadf41461032157600080fd5b80633a46b1a8116101305780633a46b1a8146101f557806342966c68146102085780634bf5d7e91461021d578063587cde1e146102255780635c19a95c146102695780636fcfff451461027c57600080fd5b806306fdde0314610178578063095ea7b31461019657806318160ddd146101b957806323b872dd146101cb578063313ce567146101de5780633644e515146101ed575b600080fd5b61018061040c565b60405161018d9190611ad2565b60405180910390f35b6101a96101a4366004611b01565b61049e565b604051901515815260200161018d565b6002545b60405190815260200161018d565b6101a96101d9366004611b2b565b6104b8565b6040516012815260200161018d565b6101bd6104dc565b6101bd610203366004611b01565b6104eb565b61021b610216366004611b67565b610571565b005b61018061057e565b610251610233366004611b80565b6001600160a01b039081166000908152600860205260409020541690565b6040516001600160a01b03909116815260200161018d565b61021b610277366004611b80565b6105f6565b61028f61028a366004611b80565b610605565b60405163ffffffff909116815260200161018d565b6101bd6102b2366004611b80565b6001600160a01b031660009081526020819052604090205490565b61021b6102db366004611b01565b610610565b6101bd6102ee366004611b80565b610625565b6102fb610630565b60405161018d9796959493929190611b9b565b6101bd61031c366004611b67565b610676565b6103296106e0565b60405165ffffffffffff909116815260200161018d565b6101806106ea565b6101bd610356366004611b80565b6106f9565b6101a9610369366004611b01565b610729565b61021b61037c366004611c45565b610737565b61021b61038f366004611c9d565b6107f4565b6101bd6103a2366004611d07565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b6103e06103db366004611d3a565b61092e565b60408051825165ffffffffffff1681526020928301516001600160d01b0316928101929092520161018d565b60606003805461041b90611d7a565b80601f016020809104026020016040519081016040528092919081815260200182805461044790611d7a565b80156104945780601f1061046957610100808354040283529160200191610494565b820191906000526020600020905b81548152906001019060200180831161047757829003601f168201915b5050505050905090565b6000336104ac81858561096b565b60019150505b92915050565b6000336104c685828561097d565b6104d18585856109fb565b506001949350505050565b60006104e6610a5a565b905090565b6000806104f66106e0565b90508065ffffffffffff16831061053657604051637669fc0f60e11b81526004810184905265ffffffffffff821660248201526044015b60405180910390fd5b61056061054284610b85565b6001600160a01b038616600090815260096020526040902090610bbc565b6001600160d01b0316949350505050565b61057b3382610c72565b50565b6060610588610ca8565b65ffffffffffff166105986106e0565b65ffffffffffff16146105be576040516301bfc1c560e61b815260040160405180910390fd5b5060408051808201909152601d81527f6d6f64653d626c6f636b6e756d6265722666726f6d3d64656661756c74000000602082015290565b336106018183610cb3565b5050565b60006104b282610d25565b61061b82338361097d565b6106018282610c72565b60006104b282610d47565b600060608060008060006060610644610d65565b61064c610d92565b60408051600080825260208201909252600f60f81b9b939a50919850469750309650945092509050565b6000806106816106e0565b90508065ffffffffffff1683106106bc57604051637669fc0f60e11b81526004810184905265ffffffffffff8216602482015260440161052d565b6106d06106c884610b85565b600a90610bbc565b6001600160d01b03169392505050565b60006104e6610ca8565b60606004805461041b90611d7a565b6001600160a01b038116600090815260096020526040812061071a90610dbf565b6001600160d01b031692915050565b6000336104ac8185856109fb565b8342111561075b57604051632341d78760e11b81526004810185905260240161052d565b604080517fe48329057bfd03d55e49b547132e39cffd9c1820ad7b9d4c5307691425d15adf60208201526001600160a01b0388169181019190915260608101869052608081018590526000906107d5906107cd9060a00160405160208183030381529060405280519060200120610df8565b858585610e25565b90506107e18187610e53565b6107eb8188610cb3565b50505050505050565b834211156108185760405163313c898160e11b81526004810185905260240161052d565b60007f6e71edae12b1b97f4d1f60370fef10105fa2faae0126114a169c64845d6126c98888886108658c6001600160a01b0316600090815260076020526040902080546001810190915590565b6040805160208101969096526001600160a01b0394851690860152929091166060840152608083015260a082015260c0810186905260e00160405160208183030381529060405280519060200120905060006108c082610df8565b905060006108d082878787610e25565b9050896001600160a01b0316816001600160a01b031614610917576040516325c0072360e11b81526001600160a01b0380831660048301528b16602482015260440161052d565b6109228a8a8a61096b565b50505050505050505050565b604080518082019091526000808252602082015261094c8383610ea6565b9392505050565b600061094c8284611dca565b600061094c8284611df1565b6109788383836001610edc565b505050565b6001600160a01b0383811660009081526001602090815260408083209386168352929052205460001981146109f557818110156109e657604051637dc7a0d960e11b81526001600160a01b0384166004820152602481018290526044810183905260640161052d565b6109f584848484036000610edc565b50505050565b6001600160a01b038316610a2557604051634b637e8f60e11b81526000600482015260240161052d565b6001600160a01b038216610a4f5760405163ec442f0560e01b81526000600482015260240161052d565b610978838383610fb1565b6000306001600160a01b037f000000000000000000000000000000000000000000000000000000000000000016148015610ab357507f000000000000000000000000000000000000000000000000000000000000000046145b15610add57507f000000000000000000000000000000000000000000000000000000000000000090565b6104e6604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60208201527f0000000000000000000000000000000000000000000000000000000000000000918101919091527f000000000000000000000000000000000000000000000000000000000000000060608201524660808201523060a082015260009060c00160405160208183030381529060405280519060200120905090565b600065ffffffffffff821115610bb8576040516306dfcc6560e41b8152603060048201526024810183905260440161052d565b5090565b815460009081816005811115610c1b576000610bd784610fbc565b610be19085611e11565b60008881526020902090915081015465ffffffffffff9081169087161015610c0b57809150610c19565b610c16816001611e24565b92505b505b6000610c29878785856110a4565b90508015610c6457610c4e87610c40600184611e11565b600091825260209091200190565b54600160301b90046001600160d01b0316610c67565b60005b979650505050505050565b6001600160a01b038216610c9c57604051634b637e8f60e11b81526000600482015260240161052d565b61060182600083610fb1565b60006104e643610b85565b6001600160a01b0382811660008181526008602052604080822080548686166001600160a01b0319821681179092559151919094169392849290917f3134e8a2e6d97e929a7e54011ea5485d7d196dd5f0ba4d4ef95803e8e3fc257f9190a46109788183610d2086611106565b611124565b6001600160a01b0381166000908152600960205260408120546104b290611290565b6001600160a01b0381166000908152600760205260408120546104b2565b60606104e67f000000000000000000000000000000000000000000000000000000000000000060056112c1565b60606104e67f000000000000000000000000000000000000000000000000000000000000000060066112c1565b80546000908015610def57610dd983610c40600184611e11565b54600160301b90046001600160d01b031661094c565b60009392505050565b60006104b2610e05610a5a565b8360405161190160f01b8152600281019290925260228201526042902090565b600080600080610e378888888861136c565b925092509250610e47828261143b565b50909695505050505050565b6001600160a01b0382166000908152600760205260409020805460018101909155818114610978576040516301d4b62360e61b81526001600160a01b03841660048201526024810182905260440161052d565b60408051808201909152600080825260208201526001600160a01b038316600090815260096020526040902061094c90836114f4565b6001600160a01b038416610f065760405163e602df0560e01b81526000600482015260240161052d565b6001600160a01b038316610f3057604051634a1406b160e11b81526000600482015260240161052d565b6001600160a01b03808516600090815260016020908152604080832093871683529290522082905580156109f557826001600160a01b0316846001600160a01b03167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92584604051610fa391815260200190565b60405180910390a350505050565b610978838383611564565b600081600003610fce57506000919050565b60006001610fdb846115cb565b901c6001901b90506001818481610ff457610ff4611e37565b048201901c9050600181848161100c5761100c611e37565b048201901c9050600181848161102457611024611e37565b048201901c9050600181848161103c5761103c611e37565b048201901c9050600181848161105457611054611e37565b048201901c9050600181848161106c5761106c611e37565b048201901c9050600181848161108457611084611e37565b048201901c905061094c8182858161109e5761109e611e37565b0461165f565b60005b818310156110fe5760006110bb8484611675565b60008781526020902090915065ffffffffffff86169082015465ffffffffffff1611156110ea578092506110f8565b6110f5816001611e24565b93505b506110a7565b509392505050565b6001600160a01b0381166000908152602081905260408120546104b2565b816001600160a01b0316836001600160a01b0316141580156111465750600081115b15610978576001600160a01b038316156111ee576001600160a01b038316600090815260096020526040812081906111899061095f61118486611690565b6116c4565b6001600160d01b031691506001600160d01b03169150846001600160a01b03167fdec2bacdd2f05b59de34da9b523dff8be42e5e38e818c82fdb0bae774387a72483836040516111e3929190918252602082015260400190565b60405180910390a250505b6001600160a01b03821615610978576001600160a01b038216600090815260096020526040812081906112279061095361118486611690565b6001600160d01b031691506001600160d01b03169150836001600160a01b03167fdec2bacdd2f05b59de34da9b523dff8be42e5e38e818c82fdb0bae774387a7248383604051611281929190918252602082015260400190565b60405180910390a25050505050565b600063ffffffff821115610bb8576040516306dfcc6560e41b8152602060048201526024810183905260440161052d565b606060ff83146112db576112d4836116fd565b90506104b2565b8180546112e790611d7a565b80601f016020809104026020016040519081016040528092919081815260200182805461131390611d7a565b80156113605780601f1061133557610100808354040283529160200191611360565b820191906000526020600020905b81548152906001019060200180831161134357829003601f168201915b505050505090506104b2565b600080807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a08411156113a75750600091506003905082611431565b604080516000808252602082018084528a905260ff891692820192909252606081018790526080810186905260019060a0016020604051602081039080840390855afa1580156113fb573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b03811661142757506000925060019150829050611431565b9250600091508190505b9450945094915050565b600082600381111561144f5761144f611e4d565b03611458575050565b600182600381111561146c5761146c611e4d565b0361148a5760405163f645eedf60e01b815260040160405180910390fd5b600282600381111561149e5761149e611e4d565b036114bf5760405163fce698f760e01b81526004810182905260240161052d565b60038260038111156114d3576114d3611e4d565b03610601576040516335e2f38360e21b81526004810182905260240161052d565b6040805180820190915260008082526020820152826000018263ffffffff168154811061152357611523611e63565b60009182526020918290206040805180820190915291015465ffffffffffff81168252600160301b90046001600160d01b0316918101919091529392505050565b61156f83838361173c565b6001600160a01b0383166115c057600061158860025490565b90506001600160d01b03808211156115bd57604051630e58ae9360e11b8152600481018390526024810182905260440161052d565b50505b610978838383611866565b600080608083901c156115e057608092831c92015b604083901c156115f257604092831c92015b602083901c1561160457602092831c92015b601083901c1561161657601092831c92015b600883901c1561162857600892831c92015b600483901c1561163a57600492831c92015b600283901c1561164c57600292831c92015b600183901c156104b25760010192915050565b600081831061166e578161094c565b5090919050565b60006116846002848418611e79565b61094c90848416611e24565b60006001600160d01b03821115610bb8576040516306dfcc6560e41b815260d060048201526024810183905260440161052d565b6000806116f06116d26106e0565b6116e86116de88610dbf565b868863ffffffff16565b8791906118dc565b915091505b935093915050565b6060600061170a836118ea565b604080516020808252818301909252919250600091906020820181803683375050509182525060208101929092525090565b6001600160a01b03831661176757806002600082825461175c9190611e24565b909155506117d99050565b6001600160a01b038316600090815260208190526040902054818110156117ba5760405163391434e360e21b81526001600160a01b0385166004820152602481018290526044810183905260640161052d565b6001600160a01b03841660009081526020819052604090209082900390555b6001600160a01b0382166117f557600280548290039055611814565b6001600160a01b03821660009081526020819052604090208054820190555b816001600160a01b0316836001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8360405161185991815260200190565b60405180910390a3505050565b6001600160a01b03831661188857611885600a61095361118484611690565b50505b6001600160a01b0382166118aa576118a7600a61095f61118484611690565b50505b6001600160a01b0383811660009081526008602052604080822054858416835291205461097892918216911683611124565b6000806116f0858585611912565b600060ff8216601f8111156104b257604051632cd44ac360e21b815260040160405180910390fd5b825460009081908015611a3157600061193087610c40600185611e11565b60408051808201909152905465ffffffffffff808216808452600160301b9092046001600160d01b03166020840152919250908716101561198457604051632520601d60e01b815260040160405180910390fd5b805165ffffffffffff8088169116036119d057846119a788610c40600186611e11565b80546001600160d01b0392909216600160301b0265ffffffffffff909216919091179055611a21565b6040805180820190915265ffffffffffff80881682526001600160d01b0380881660208085019182528b54600181018d5560008d81529190912094519151909216600160301b029216919091179101555b6020015192508391506116f59050565b50506040805180820190915265ffffffffffff80851682526001600160d01b0380851660208085019182528854600181018a5560008a815291822095519251909316600160301b0291909316179201919091559050816116f5565b6000815180845260005b81811015611ab257602081850181015186830182015201611a96565b506000602082860101526020601f19601f83011685010191505092915050565b60208152600061094c6020830184611a8c565b80356001600160a01b0381168114611afc57600080fd5b919050565b60008060408385031215611b1457600080fd5b611b1d83611ae5565b946020939093013593505050565b600080600060608486031215611b4057600080fd5b611b4984611ae5565b9250611b5760208501611ae5565b9150604084013590509250925092565b600060208284031215611b7957600080fd5b5035919050565b600060208284031215611b9257600080fd5b61094c82611ae5565b60ff60f81b881681526000602060e06020840152611bbc60e084018a611a8c565b8381036040850152611bce818a611a8c565b606085018990526001600160a01b038816608086015260a0850187905284810360c08601528551808252602080880193509091019060005b81811015611c2257835183529284019291840191600101611c06565b50909c9b505050505050505050505050565b803560ff81168114611afc57600080fd5b60008060008060008060c08789031215611c5e57600080fd5b611c6787611ae5565b95506020870135945060408701359350611c8360608801611c34565b92506080870135915060a087013590509295509295509295565b600080600080600080600060e0888a031215611cb857600080fd5b611cc188611ae5565b9650611ccf60208901611ae5565b95506040880135945060608801359350611ceb60808901611c34565b925060a0880135915060c0880135905092959891949750929550565b60008060408385031215611d1a57600080fd5b611d2383611ae5565b9150611d3160208401611ae5565b90509250929050565b60008060408385031215611d4d57600080fd5b611d5683611ae5565b9150602083013563ffffffff81168114611d6f57600080fd5b809150509250929050565b600181811c90821680611d8e57607f821691505b602082108103611dae57634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b6001600160d01b03818116838216019080821115611dea57611dea611db4565b5092915050565b6001600160d01b03828116828216039080821115611dea57611dea611db4565b818103818111156104b2576104b2611db4565b808201808211156104b2576104b2611db4565b634e487b7160e01b600052601260045260246000fd5b634e487b7160e01b600052602160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b600082611e9657634e487b7160e01b600052601260045260246000fd5b50049056fea2646970667358221220fc6ea3f1eb91ed25fcfd6dd411ce6d545e3151e21e157a03a22e0a82e633d2ca64736f6c63430008180033`;

export const governorSourceCode = `// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/governance/Governor.sol";
import "@openzeppelin/contracts/governance/extensions/GovernorCountingSimple.sol";
import "@openzeppelin/contracts/governance/extensions/GovernorVotes.sol";
import "@openzeppelin/contracts/governance/extensions/GovernorVotesQuorumFraction.sol";

/// @custom:security-contact contact@agentswithbenefits.xyz
contract DAOGovernor is
    Governor,
    GovernorCountingSimple,
    GovernorVotes,
    GovernorVotesQuorumFraction
{
    uint256 internal initialVotingDelay;
    uint256 internal initialVotingPeriod;
    uint256 internal initialProposalThreshold;

    constructor(
        string memory _name,
        IVotes _token,
        uint256 _votingDelay,
        uint256 _votingPeriod,
        uint256 _proposalThreshold,
        uint256 _quorumVotes
    )
        Governor(_name)
        GovernorVotes(_token)
        GovernorVotesQuorumFraction(_quorumVotes)
    {
        initialVotingDelay = _votingDelay;
        initialVotingPeriod = _votingPeriod;
        initialProposalThreshold = _proposalThreshold;
    }

    function votingDelay() public view override returns (uint256) {
        return initialVotingDelay;
    }

    function votingPeriod() public view override returns (uint256) {
        return initialVotingPeriod;
    }

    function proposalThreshold() public view override returns (uint256) {
        return initialProposalThreshold;
    }

    // The following functions are overrides required by Solidity.

    function quorum(
        uint256 blockNumber
    )
        public
        view
        override(Governor, GovernorVotesQuorumFraction)
        returns (uint256)
    {
        return super.quorum(blockNumber);
    }
}
`;

export const governorByteCode = `0x6101806040523480156200001257600080fd5b5060405162004289380380620042898339810160408190526200003591620005d9565b80858780620000586040805180820190915260018152603160f81b602082015290565b620000658260006200014c565b61012052620000768160016200014c565b61014052815160208084019190912060e052815190820120610100524660a0526200010460e05161010051604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60208201529081019290925260608201524660808201523060a082015260009060c00160405160208183030381529060405280519060200120905090565b60805250503060c05260036200011b82826200075c565b50506001600160a01b031661016052620001358162000185565b5050600992909255600a55600b5550620008ce9050565b60006020835110156200016c57620001648362000229565b90506200017f565b816200017984826200075c565b5060ff90505b92915050565b606480821115620001b85760405163243e544560e01b815260048101839052602481018290526044015b60405180910390fd5b6000620001c46200026c565b9050620001e9620001d462000288565b620001df856200030a565b6008919062000344565b505060408051828152602081018590527f0553476bf02ef2726e8ce5ced78d63e26e602e4a2257b1f559418e24b4633997910160405180910390a1505050565b600080829050601f8151111562000257578260405163305a27a960e01b8152600401620001af919062000828565b805162000264826200085d565b179392505050565b60006200027a600862000361565b6001600160d01b0316905090565b6000620002956101605190565b6001600160a01b03166391ddadf46040518163ffffffff1660e01b8152600401602060405180830381865afa925050508015620002f1575060408051601f3d908101601f19168201909252620002ee9181019062000882565b60015b620003055762000300620003b1565b905090565b919050565b60006001600160d01b0382111562000340576040516306dfcc6560e41b815260d0600482015260248101839052604401620001af565b5090565b60008062000354858585620003be565b915091505b935093915050565b80546000908015620003a7576200038d836200037f600184620008ac565b600091825260209091200190565b54660100000000000090046001600160d01b0316620003aa565b60005b9392505050565b6000620003004362000550565b825460009081908015620004f1576000620003e0876200037f600185620008ac565b60408051808201909152905465ffffffffffff80821680845266010000000000009092046001600160d01b0316602084015291925090871610156200043857604051632520601d60e01b815260040160405180910390fd5b805165ffffffffffff8088169116036200048c57846200045f886200037f600186620008ac565b80546001600160d01b039290921666010000000000000265ffffffffffff909216919091179055620004e0565b6040805180820190915265ffffffffffff80881682526001600160d01b0380881660208085019182528b54600181018d5560008d815291909120945191519092166601000000000000029216919091179101555b602001519250839150620003599050565b50506040805180820190915265ffffffffffff80851682526001600160d01b0380851660208085019182528854600181018a5560008a815291822095519251909316660100000000000002919093161792019190915590508162000359565b600065ffffffffffff82111562000340576040516306dfcc6560e41b81526030600482015260248101839052604401620001af565b634e487b7160e01b600052604160045260246000fd5b60005b83811015620005b85781810151838201526020016200059e565b50506000910152565b80516001600160a01b03811681146200030557600080fd5b60008060008060008060c08789031215620005f357600080fd5b86516001600160401b03808211156200060b57600080fd5b818901915089601f8301126200062057600080fd5b81518181111562000635576200063562000585565b604051601f8201601f19908116603f0116810190838211818310171562000660576200066062000585565b816040528281528c60208487010111156200067a57600080fd5b6200068d8360208301602088016200059b565b809a505050505050620006a360208801620005c1565b945060408701519350606087015192506080870151915060a087015190509295509295509295565b600181811c90821680620006e057607f821691505b6020821081036200070157634e487b7160e01b600052602260045260246000fd5b50919050565b601f82111562000757576000816000526020600020601f850160051c81016020861015620007325750805b601f850160051c820191505b8181101562000753578281556001016200073e565b5050505b505050565b81516001600160401b0381111562000778576200077862000585565b6200079081620007898454620006cb565b8462000707565b602080601f831160018114620007c85760008415620007af5750858301515b600019600386901b1c1916600185901b17855562000753565b600085815260208120601f198616915b82811015620007f957888601518255948401946001909101908401620007d8565b5085821015620008185787850151600019600388901b60f8161c191681555b5050505050600190811b01905550565b6020815260008251806020840152620008498160408501602087016200059b565b601f01601f19169190910160400192915050565b80516020808301519190811015620007015760001960209190910360031b1b16919050565b6000602082840312156200089557600080fd5b815165ffffffffffff81168114620003aa57600080fd5b818103818111156200017f57634e487b7160e01b600052601160045260246000fd5b60805160a05160c05160e0516101005161012051610140516101605161393962000950600039600081816108f201528181610d4c0152818161129701528181611dba0152611ecc01526000611d8501526000611d58015260006120f2015260006120ca015260006120250152600061204f0152600061207901526139396000f3fe6080604052600436106102605760003560e01c80637b3c71d311610144578063b58131b0116100b6578063dd4e2ba51161007a578063dd4e2ba5146107fd578063deaaa7cc14610843578063eb9019d414610877578063f23a6e6114610897578063f8ce560a146108c3578063fc0c546a146108e357600080fd5b8063b58131b014610769578063bc197c811461077e578063c01f9e37146107aa578063c28bc2fa146107ca578063c59057e4146107dd57600080fd5b806391ddadf41161010857806391ddadf41461069b57806397c3d334146106c75780639a802a6d146106db578063a7713a70146106fb578063a9a9529414610710578063ab58fb8e1461073157600080fd5b80637b3c71d3146105dd5780637d5e81e2146105fd5780637ecebe001461061d57806384b0196e146106535780638ff262e31461067b57600080fd5b80633932abb1116101dd578063544ffc9c116101a1578063544ffc9c146104de57806354fd4d5014610533578063567813881461055d5780635b8d0e0d1461057d5780635f398a141461059d57806360c4247f146105bd57600080fd5b80633932abb11461041d5780633e4f49e614610432578063438596321461045f578063452115d6146104a95780634bf5d7e9146104c957600080fd5b8063150b7a0211610224578063150b7a0214610352578063160cbed7146103965780632656227d146103b65780632d63f693146103c95780632fe3e261146103e957600080fd5b806301ffc9a71461026e57806302a251a3146102a357806306f3f9e6146102c257806306fdde03146102e2578063143489d01461030457600080fd5b3661026957005b005b600080fd5b34801561027a57600080fd5b5061028e6102893660046129ba565b610916565b60405190151581526020015b60405180910390f35b3480156102af57600080fd5b50600a545b60405190815260200161029a565b3480156102ce57600080fd5b506102676102dd3660046129e4565b610968565b3480156102ee57600080fd5b506102f761097c565b60405161029a9190612a4d565b34801561031057600080fd5b5061033a61031f3660046129e4565b6000908152600460205260409020546001600160a01b031690565b6040516001600160a01b03909116815260200161029a565b34801561035e57600080fd5b5061037d61036d366004612b42565b630a85bd0160e11b949350505050565b6040516001600160e01b0319909116815260200161029a565b3480156103a257600080fd5b506102b46103b1366004612d1b565b610a0e565b6102b46103c4366004612d1b565b610a4e565b3480156103d557600080fd5b506102b46103e43660046129e4565b610b79565b3480156103f557600080fd5b506102b47f3e83946653575f9a39005e1545185629e92736b7528ab20ca3816f315424a81181565b34801561042957600080fd5b506009546102b4565b34801561043e57600080fd5b5061045261044d3660046129e4565b610b9a565b60405161029a9190612de2565b34801561046b57600080fd5b5061028e61047a366004612df0565b60008281526007602090815260408083206001600160a01b038516845260030190915290205460ff1692915050565b3480156104b557600080fd5b506102b46104c4366004612d1b565b610cd9565b3480156104d557600080fd5b506102f7610d48565b3480156104ea57600080fd5b506105186104f93660046129e4565b6000908152600760205260409020805460018201546002909201549092565b6040805193845260208401929092529082015260600161029a565b34801561053f57600080fd5b506040805180820190915260018152603160f81b60208201526102f7565b34801561056957600080fd5b506102b4610578366004612e2d565b610e0a565b34801561058957600080fd5b506102b4610598366004612e98565b610e33565b3480156105a957600080fd5b506102b46105b8366004612f50565b610f92565b3480156105c957600080fd5b506102b46105d83660046129e4565b610fe7565b3480156105e957600080fd5b506102b46105f8366004612fd3565b611075565b34801561060957600080fd5b506102b461061836600461302c565b6110bd565b34801561062957600080fd5b506102b46106383660046130e0565b6001600160a01b031660009081526002602052604090205490565b34801561065f57600080fd5b5061066861117b565b60405161029a9796959493929190613137565b34801561068757600080fd5b506102b46106963660046131a7565b6111c1565b3480156106a757600080fd5b506106b0611293565b60405165ffffffffffff909116815260200161029a565b3480156106d357600080fd5b5060646102b4565b3480156106e757600080fd5b506102b46106f63660046131f6565b611320565b34801561070757600080fd5b506102b461132d565b34801561071c57600080fd5b5061028e61072b3660046129e4565b50600090565b34801561073d57600080fd5b506102b461074c3660046129e4565b60009081526004602052604090206001015465ffffffffffff1690565b34801561077557600080fd5b50600b546102b4565b34801561078a57600080fd5b5061037d61079936600461324c565b63bc197c8160e01b95945050505050565b3480156107b657600080fd5b506102b46107c53660046129e4565b611347565b6102676107d83660046132db565b61138a565b3480156107e957600080fd5b506102b46107f8366004612d1b565b61140a565b34801561080957600080fd5b506040805180820190915260208082527f737570706f72743d627261766f2671756f72756d3d666f722c6162737461696e908201526102f7565b34801561084f57600080fd5b506102b47ff2aad550cf55f045cb27e9c559f9889fdfb6e6cdaa032301d6ea397784ae51d781565b34801561088357600080fd5b506102b461089236600461331c565b611444565b3480156108a357600080fd5b5061037d6108b2366004613346565b63f23a6e6160e01b95945050505050565b3480156108cf57600080fd5b506102b46108de3660046129e4565b61146c565b3480156108ef57600080fd5b507f000000000000000000000000000000000000000000000000000000000000000061033a565b60006001600160e01b031982166332a2ad4360e11b148061094757506001600160e01b03198216630271189760e51b145b8061096257506301ffc9a760e01b6001600160e01b03198316145b92915050565b610970611477565b610979816114ae565b50565b60606003805461098b906133aa565b80601f01602080910402602001604051908101604052809291908181526020018280546109b7906133aa565b8015610a045780601f106109d957610100808354040283529160200191610a04565b820191906000526020600020905b8154815290600101906020018083116109e757829003601f168201915b5050505050905090565b600080610a1d8686868661140a565b9050610a3281610a2d6004611544565b611567565b506000604051634844252360e11b815260040160405180910390fd5b600080610a5d8686868661140a565b9050610a7d81610a6d6005611544565b610a776004611544565b17611567565b506000818152600460205260409020805460ff60f01b1916600160f01b17905530610aa53090565b6001600160a01b031614610b2f5760005b8651811015610b2d57306001600160a01b0316878281518110610adb57610adb6133e4565b60200260200101516001600160a01b031603610b2557610b25858281518110610b0657610b066133e4565b60200260200101518051906020012060056115a690919063ffffffff16565b600101610ab6565b505b610b3c8187878787611617565b6040518181527f712ae1383f79ac853f8d882153778e0260ef8f03b504e2866e0593e04d2b291f906020015b60405180910390a195945050505050565b600090815260046020526040902054600160a01b900465ffffffffffff1690565b6000818152600460205260408120805460ff600160f01b8204811691600160f81b9004168115610bcf57506007949350505050565b8015610be057506002949350505050565b6000610beb86610b79565b905080600003610c1657604051636ad0607560e01b8152600481018790526024015b60405180910390fd5b6000610c20611293565b65ffffffffffff169050808210610c3e575060009695505050505050565b6000610c4988611347565b9050818110610c6057506001979650505050505050565b610c69886116f1565b1580610c8957506000888152600760205260409020805460019091015411155b15610c9c57506003979650505050505050565b60008881526004602052604090206001015465ffffffffffff16600003610ccb57506004979650505050505050565b506005979650505050505050565b600080610ce88686868661140a565b9050610cf881610a2d6000611544565b506000818152600460205260409020546001600160a01b03163314610d325760405163233d98e360e01b8152336004820152602401610c0d565b610d3e86868686611728565b9695505050505050565b60607f00000000000000000000000000000000000000000000000000000000000000006001600160a01b0316634bf5d7e96040518163ffffffff1660e01b8152600401600060405180830381865afa925050508015610dc957506040513d6000823e601f3d908101601f19168201604052610dc691908101906133fa565b60015b610e05575060408051808201909152601d81527f6d6f64653d626c6f636b6e756d6265722666726f6d3d64656661756c74000000602082015290565b919050565b600080339050610e2b848285604051806020016040528060008152506117d9565b949350505050565b600080610f1687610f107f3e83946653575f9a39005e1545185629e92736b7528ab20ca3816f315424a8118c8c8c610e888e6001600160a01b0316600090815260026020526040902080546001810190915590565b8d8d604051610e98929190613467565b60405180910390208c80519060200120604051602001610ef59796959493929190968752602087019590955260ff9390931660408601526001600160a01b03919091166060850152608084015260a083015260c082015260e00190565b60405160208183030381529060405280519060200120611805565b85611832565b905080610f41576040516394ab6c0760e01b81526001600160a01b0388166004820152602401610c0d565b610f8589888a89898080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152508b925061188a915050565b9998505050505050505050565b600080339050610fdc87828888888080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152508a925061188a915050565b979650505050505050565b600880546000918290610ffb60018461348d565b8154811061100b5761100b6133e4565b6000918252602090912001805490915065ffffffffffff811690600160301b90046001600160d01b031685821161104e576001600160d01b031695945050505050565b61106261105a87611967565b60089061199e565b6001600160d01b03169695505050505050565b600080339050610d3e86828787878080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152506117d992505050565b6000336110ca8184611a53565b6110f25760405163d9b3955760e01b81526001600160a01b0382166004820152602401610c0d565b6000611119826001611102611293565b61110c91906134a0565b65ffffffffffff16611444565b90506000611126600b5490565b90508082101561116257604051636121770b60e11b81526001600160a01b03841660048201526024810183905260448101829052606401610c0d565b61116f8888888887611b3e565b98975050505050505050565b60006060806000806000606061118f611d51565b611197611d7e565b60408051600080825260208201909252600f60f81b9b939a50919850469750309650945092509050565b60008061124d84610f107ff2aad550cf55f045cb27e9c559f9889fdfb6e6cdaa032301d6ea397784ae51d78989896112168b6001600160a01b0316600090815260026020526040902080546001810190915590565b60408051602081019690965285019390935260ff90911660608401526001600160a01b0316608083015260a082015260c001610ef5565b905080611278576040516394ab6c0760e01b81526001600160a01b0385166004820152602401610c0d565b610d3e868587604051806020016040528060008152506117d9565b60007f00000000000000000000000000000000000000000000000000000000000000006001600160a01b03166391ddadf46040518163ffffffff1660e01b8152600401602060405180830381865afa92505050801561130f575060408051601f3d908101601f1916820190925261130c918101906134c6565b60015b610e055761131b611dab565b905090565b6000610e2b848484611db6565b60006113396008611e4c565b6001600160d01b0316905090565b60008181526004602052604081205461137c90600160d01b810463ffffffff1690600160a01b900465ffffffffffff166134ee565b65ffffffffffff1692915050565b611392611477565b600080856001600160a01b03168585856040516113b0929190613467565b60006040518083038185875af1925050503d80600081146113ed576040519150601f19603f3d011682016040523d82523d6000602084013e6113f2565b606091505b50915091506114018282611e85565b50505050505050565b60008484848460405160200161142394939291906135a1565b60408051601f19818403018152919052805160209091012095945050505050565b6000611465838361146060408051602081019091526000815290565b611db6565b9392505050565b600061096282611ea1565b303314611499576040516347096e4760e01b8152336004820152602401610c0d565b565b806114a66005611f4b565b0361149b5750565b6064808211156114db5760405163243e544560e01b81526004810183905260248101829052604401610c0d565b60006114e561132d565b90506115046114f2611293565b6114fb85611fc9565b60089190611ffd565b505060408051828152602081018590527f0553476bf02ef2726e8ce5ced78d63e26e602e4a2257b1f559418e24b4633997910160405180910390a1505050565b600081600781111561155857611558612daa565b600160ff919091161b92915050565b60008061157384610b9a565b905060008361158183611544565b1603611465578381846040516331b75e4d60e01b8152600401610c0d939291906135ec565b81546001600160801b03600160801b8204811691811660018301909116036115e157604051638acb5f2760e01b815260040160405180910390fd5b6001600160801b03808216600090815260018086016020526040909120939093558354919092018216600160801b029116179055565b60005b84518110156116e957600080868381518110611638576116386133e4565b60200260200101516001600160a01b031686848151811061165b5761165b6133e4565b6020026020010151868581518110611675576116756133e4565b602002602001015160405161168a919061360e565b60006040518083038185875af1925050503d80600081146116c7576040519150601f19603f3d011682016040523d82523d6000602084013e6116cc565b606091505b50915091506116db8282611e85565b50505080600101905061161a565b505050505050565b600081815260076020526040812060028101546001820154611713919061362a565b61171f6108de85610b79565b11159392505050565b6000806117378686868661140a565b9050611785816117476007611544565b6117516006611544565b61175b6002611544565b600161176860078261363d565b61177390600261373a565b61177d919061348d565b181818611567565b506000818152600460205260409081902080546001600160f81b0316600160f81b179055517f789cf55be980739dad1d0699b93b58e806b51c9d96619bfa8fe0a28abaa7b30c90610b689083815260200190565b60006117fc858585856117f760408051602081019091526000815290565b61188a565b95945050505050565b6000610962611812612018565b8360405161190160f01b8152600281019290925260228201526042902090565b60008060006118418585612143565b509092509050600081600381111561185b5761185b612daa565b1480156118795750856001600160a01b0316826001600160a01b0316145b80610d3e5750610d3e868686612190565b600061189a86610a2d6001611544565b5060006118b0866118aa89610b79565b85611db6565b90506118bf878787848761226b565b825160000361191457856001600160a01b03167fb8e138887d0aa13bab447e82de9d5c1777041ecd21ca36ba824ff1e6c07ddda4888784886040516119079493929190613749565b60405180910390a2610d3e565b856001600160a01b03167fe2babfbac5889a709b63bb7f598b324e08bc5a4fb9ec647fb3cbc9ec07eb87128887848888604051611955959493929190613771565b60405180910390a29695505050505050565b600065ffffffffffff82111561199a576040516306dfcc6560e41b81526030600482015260248101839052604401610c0d565b5090565b8154600090818160058111156119fd5760006119b984612364565b6119c3908561348d565b60008881526020902090915081015465ffffffffffff90811690871610156119ed578091506119fb565b6119f881600161362a565b92505b505b6000611a0b8787858561244c565b90508015611a4657611a3087611a2260018461348d565b600091825260209091200190565b54600160301b90046001600160d01b0316610fdc565b6000979650505050505050565b80516000906034811015611a6b576001915050610962565b82810160131901516001600160a01b031981166b046e0e4dee0dee6cae47a60f60a31b14611a9e57600192505050610962565b600080611aac60288561348d565b90505b83811015611b1d57600080611ae3888481518110611acf57611acf6133e4565b01602001516001600160f81b0319166124ae565b9150915081611afb5760019650505050505050610962565b8060ff166004856001600160a01b0316901b1793505050806001019050611aaf565b50856001600160a01b0316816001600160a01b031614935050505092915050565b6000611b53868686868051906020012061140a565b905084518651141580611b6857508351865114155b80611b7257508551155b15611ba757855184518651604051630447b05d60e41b8152600481019390935260248301919091526044820152606401610c0d565b600081815260046020526040902054600160a01b900465ffffffffffff1615611bf25780611bd482610b9a565b6040516331b75e4d60e01b8152610c0d9291906000906004016135ec565b6000611bfd60095490565b611c05611293565b65ffffffffffff16611c17919061362a565b90506000611c24600a5490565b600084815260046020526040902080546001600160a01b0319166001600160a01b038716178155909150611c5783611967565b815465ffffffffffff91909116600160a01b0265ffffffffffff60a01b19909116178155611c8482612540565b815463ffffffff91909116600160d01b0263ffffffff60d01b1990911617815588517f7d84a6263ae0d98d3329bd7b46bb4e8d6f98cd35a7adb45c274c8b7fd5ebd5e090859087908c908c906001600160401b03811115611ce757611ce7612a77565b604051908082528060200260200182016040528015611d1a57816020015b6060815260200190600190039081611d055790505b508c89611d278a8261362a565b8e604051611d3d999897969594939291906137ab565b60405180910390a150505095945050505050565b606061131b7f00000000000000000000000000000000000000000000000000000000000000006000612571565b606061131b7f00000000000000000000000000000000000000000000000000000000000000006001612571565b600061131b43611967565b60007f0000000000000000000000000000000000000000000000000000000000000000604051630748d63560e31b81526001600160a01b038681166004830152602482018690529190911690633a46b1a890604401602060405180830381865afa158015611e28573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610e2b9190613882565b80546000908015611e7c57611e6683611a2260018461348d565b54600160301b90046001600160d01b0316611465565b60009392505050565b606082611e9a57611e958261261c565b610962565b5080610962565b60006064611eae83610fe7565b604051632394e7a360e21b8152600481018590526001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001690638e539e8c90602401602060405180830381865afa158015611f13573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611f379190613882565b611f41919061389b565b61096291906138c8565b80546000906001600160801b0380821691600160801b9004168103611f83576040516375e52f4f60e01b815260040160405180910390fd5b6001600160801b038181166000908152600185810160205260408220805492905585546fffffffffffffffffffffffffffffffff19169301909116919091179092555090565b60006001600160d01b0382111561199a576040516306dfcc6560e41b815260d0600482015260248101839052604401610c0d565b60008061200b858585612645565b915091505b935093915050565b6000306001600160a01b037f00000000000000000000000000000000000000000000000000000000000000001614801561207157507f000000000000000000000000000000000000000000000000000000000000000046145b1561209b57507f000000000000000000000000000000000000000000000000000000000000000090565b61131b604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f60208201527f0000000000000000000000000000000000000000000000000000000000000000918101919091527f000000000000000000000000000000000000000000000000000000000000000060608201524660808201523060a082015260009060c00160405160208183030381529060405280519060200120905090565b6000806000835160410361217d5760208401516040850151606086015160001a61216f888285856127bf565b955095509550505050612189565b50508151600091506002905b9250925092565b6000806000856001600160a01b031685856040516024016121b29291906138ea565b60408051601f198184030181529181526020820180516001600160e01b0316630b135d3f60e11b179052516121e7919061360e565b600060405180830381855afa9150503d8060008114612222576040519150601f19603f3d011682016040523d82523d6000602084013e612227565b606091505b509150915081801561223b57506020815110155b8015610d3e57508051630b135d3f60e11b906122609083016020908101908401613882565b149695505050505050565b60008581526007602090815260408083206001600160a01b0388168452600381019092529091205460ff16156122bf576040516371c6af4960e01b81526001600160a01b0386166004820152602401610c0d565b6001600160a01b03851660009081526003820160205260409020805460ff1916600117905560ff841661230b5782816000016000828254612300919061362a565b909155506116e99050565b60001960ff85160161232b5782816001016000828254612300919061362a565b60011960ff85160161234b5782816002016000828254612300919061362a565b6040516303599be160e11b815260040160405180910390fd5b60008160000361237657506000919050565b600060016123838461288e565b901c6001901b9050600181848161239c5761239c6138b2565b048201901c905060018184816123b4576123b46138b2565b048201901c905060018184816123cc576123cc6138b2565b048201901c905060018184816123e4576123e46138b2565b048201901c905060018184816123fc576123fc6138b2565b048201901c90506001818481612414576124146138b2565b048201901c9050600181848161242c5761242c6138b2565b048201901c905061146581828581612446576124466138b2565b04612922565b60005b818310156124a65760006124638484612938565b60008781526020902090915065ffffffffffff86169082015465ffffffffffff161115612492578092506124a0565b61249d81600161362a565b93505b5061244f565b509392505050565b60008060f883901c602f811180156124c95750603a8160ff16105b156124de57600194602f199091019350915050565b8060ff1660401080156124f4575060478160ff16105b15612509576001946036199091019350915050565b8060ff16606010801561251f575060678160ff16105b15612534576001946056199091019350915050565b50600093849350915050565b600063ffffffff82111561199a576040516306dfcc6560e41b81526020600482015260248101839052604401610c0d565b606060ff831461258b5761258483612953565b9050610962565b818054612597906133aa565b80601f01602080910402602001604051908101604052809291908181526020018280546125c3906133aa565b80156126105780601f106125e557610100808354040283529160200191612610565b820191906000526020600020905b8154815290600101906020018083116125f357829003601f168201915b50505050509050610962565b80511561262c5780518082602001fd5b604051630a12f52160e11b815260040160405180910390fd5b82546000908190801561276457600061266387611a2260018561348d565b60408051808201909152905465ffffffffffff808216808452600160301b9092046001600160d01b0316602084015291925090871610156126b757604051632520601d60e01b815260040160405180910390fd5b805165ffffffffffff80881691160361270357846126da88611a2260018661348d565b80546001600160d01b0392909216600160301b0265ffffffffffff909216919091179055612754565b6040805180820190915265ffffffffffff80881682526001600160d01b0380881660208085019182528b54600181018d5560008d81529190912094519151909216600160301b029216919091179101555b6020015192508391506120109050565b50506040805180820190915265ffffffffffff80851682526001600160d01b0380851660208085019182528854600181018a5560008a815291822095519251909316600160301b029190931617920191909155905081612010565b600080807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a08411156127fa5750600091506003905082612884565b604080516000808252602082018084528a905260ff891692820192909252606081018790526080810186905260019060a0016020604051602081039080840390855afa15801561284e573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b03811661287a57506000925060019150829050612884565b9250600091508190505b9450945094915050565b600080608083901c156128a357608092831c92015b604083901c156128b557604092831c92015b602083901c156128c757602092831c92015b601083901c156128d957601092831c92015b600883901c156128eb57600892831c92015b600483901c156128fd57600492831c92015b600283901c1561290f57600292831c92015b600183901c156109625760010192915050565b60008183106129315781611465565b5090919050565b600061294760028484186138c8565b6114659084841661362a565b6060600061296083612992565b604080516020808252818301909252919250600091906020820181803683375050509182525060208101929092525090565b600060ff8216601f81111561096257604051632cd44ac360e21b815260040160405180910390fd5b6000602082840312156129cc57600080fd5b81356001600160e01b03198116811461146557600080fd5b6000602082840312156129f657600080fd5b5035919050565b60005b83811015612a18578181015183820152602001612a00565b50506000910152565b60008151808452612a398160208601602086016129fd565b601f01601f19169290920160200192915050565b6020815260006114656020830184612a21565b80356001600160a01b0381168114610e0557600080fd5b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f191681016001600160401b0381118282101715612ab557612ab5612a77565b604052919050565b60006001600160401b03821115612ad657612ad6612a77565b50601f01601f191660200190565b6000612af7612af284612abd565b612a8d565b9050828152838383011115612b0b57600080fd5b828260208301376000602084830101529392505050565b600082601f830112612b3357600080fd5b61146583833560208501612ae4565b60008060008060808587031215612b5857600080fd5b612b6185612a60565b9350612b6f60208601612a60565b92506040850135915060608501356001600160401b03811115612b9157600080fd5b612b9d87828801612b22565b91505092959194509250565b60006001600160401b03821115612bc257612bc2612a77565b5060051b60200190565b600082601f830112612bdd57600080fd5b81356020612bed612af283612ba9565b8083825260208201915060208460051b870101935086841115612c0f57600080fd5b602086015b84811015612c3257612c2581612a60565b8352918301918301612c14565b509695505050505050565b600082601f830112612c4e57600080fd5b81356020612c5e612af283612ba9565b8083825260208201915060208460051b870101935086841115612c8057600080fd5b602086015b84811015612c325780358352918301918301612c85565b600082601f830112612cad57600080fd5b81356020612cbd612af283612ba9565b82815260059290921b84018101918181019086841115612cdc57600080fd5b8286015b84811015612c325780356001600160401b03811115612cff5760008081fd5b612d0d8986838b0101612b22565b845250918301918301612ce0565b60008060008060808587031215612d3157600080fd5b84356001600160401b0380821115612d4857600080fd5b612d5488838901612bcc565b95506020870135915080821115612d6a57600080fd5b612d7688838901612c3d565b94506040870135915080821115612d8c57600080fd5b50612d9987828801612c9c565b949793965093946060013593505050565b634e487b7160e01b600052602160045260246000fd5b60088110612dde57634e487b7160e01b600052602160045260246000fd5b9052565b602081016109628284612dc0565b60008060408385031215612e0357600080fd5b82359150612e1360208401612a60565b90509250929050565b803560ff81168114610e0557600080fd5b60008060408385031215612e4057600080fd5b82359150612e1360208401612e1c565b60008083601f840112612e6257600080fd5b5081356001600160401b03811115612e7957600080fd5b602083019150836020828501011115612e9157600080fd5b9250929050565b600080600080600080600060c0888a031215612eb357600080fd5b87359650612ec360208901612e1c565b9550612ed160408901612a60565b945060608801356001600160401b0380821115612eed57600080fd5b612ef98b838c01612e50565b909650945060808a0135915080821115612f1257600080fd5b612f1e8b838c01612b22565b935060a08a0135915080821115612f3457600080fd5b50612f418a828b01612b22565b91505092959891949750929550565b600080600080600060808688031215612f6857600080fd5b85359450612f7860208701612e1c565b935060408601356001600160401b0380821115612f9457600080fd5b612fa089838a01612e50565b90955093506060880135915080821115612fb957600080fd5b50612fc688828901612b22565b9150509295509295909350565b60008060008060608587031215612fe957600080fd5b84359350612ff960208601612e1c565b925060408501356001600160401b0381111561301457600080fd5b61302087828801612e50565b95989497509550505050565b6000806000806080858703121561304257600080fd5b84356001600160401b038082111561305957600080fd5b61306588838901612bcc565b9550602087013591508082111561307b57600080fd5b61308788838901612c3d565b9450604087013591508082111561309d57600080fd5b6130a988838901612c9c565b935060608701359150808211156130bf57600080fd5b508501601f810187136130d157600080fd5b612b9d87823560208401612ae4565b6000602082840312156130f257600080fd5b61146582612a60565b60008151808452602080850194506020840160005b8381101561312c57815187529582019590820190600101613110565b509495945050505050565b60ff60f81b8816815260e06020820152600061315660e0830189612a21565b82810360408401526131688189612a21565b606084018890526001600160a01b038716608085015260a0840186905283810360c0850152905061319981856130fb565b9a9950505050505050505050565b600080600080608085870312156131bd57600080fd5b843593506131cd60208601612e1c565b92506131db60408601612a60565b915060608501356001600160401b03811115612b9157600080fd5b60008060006060848603121561320b57600080fd5b61321484612a60565b92506020840135915060408401356001600160401b0381111561323657600080fd5b61324286828701612b22565b9150509250925092565b600080600080600060a0868803121561326457600080fd5b61326d86612a60565b945061327b60208701612a60565b935060408601356001600160401b038082111561329757600080fd5b6132a389838a01612c3d565b945060608801359150808211156132b957600080fd5b6132c589838a01612c3d565b93506080880135915080821115612fb957600080fd5b600080600080606085870312156132f157600080fd5b6132fa85612a60565b93506020850135925060408501356001600160401b0381111561301457600080fd5b6000806040838503121561332f57600080fd5b61333883612a60565b946020939093013593505050565b600080600080600060a0868803121561335e57600080fd5b61336786612a60565b945061337560208701612a60565b9350604086013592506060860135915060808601356001600160401b0381111561339e57600080fd5b612fc688828901612b22565b600181811c908216806133be57607f821691505b6020821081036133de57634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052603260045260246000fd5b60006020828403121561340c57600080fd5b81516001600160401b0381111561342257600080fd5b8201601f8101841361343357600080fd5b8051613441612af282612abd565b81815285602083850101111561345657600080fd5b6117fc8260208301602086016129fd565b8183823760009101908152919050565b634e487b7160e01b600052601160045260246000fd5b8181038181111561096257610962613477565b65ffffffffffff8281168282160390808211156134bf576134bf613477565b5092915050565b6000602082840312156134d857600080fd5b815165ffffffffffff8116811461146557600080fd5b65ffffffffffff8181168382160190808211156134bf576134bf613477565b60008151808452602080850194506020840160005b8381101561312c5781516001600160a01b031687529582019590820190600101613522565b60008282518085526020808601955060208260051b8401016020860160005b8481101561359457601f19868403018952613582838351612a21565b98840198925090830190600101613566565b5090979650505050505050565b6080815260006135b4608083018761350d565b82810360208401526135c681876130fb565b905082810360408401526135da8186613547565b91505082606083015295945050505050565b838152606081016136006020830185612dc0565b826040830152949350505050565b600082516136208184602087016129fd565b9190910192915050565b8082018082111561096257610962613477565b60ff818116838216019081111561096257610962613477565b600181815b8085111561369157816000190482111561367757613677613477565b8085161561368457918102915b93841c939080029061365b565b509250929050565b6000826136a857506001610962565b816136b557506000610962565b81600181146136cb57600281146136d5576136f1565b6001915050610962565b60ff8411156136e6576136e6613477565b50506001821b610962565b5060208310610133831016604e8410600b8410161715613714575081810a610962565b61371e8383613656565b806000190482111561373257613732613477565b029392505050565b600061146560ff841683613699565b84815260ff84166020820152826040820152608060608201526000610d3e6080830184612a21565b85815260ff8516602082015283604082015260a06060820152600061379960a0830185612a21565b828103608084015261116f8185612a21565b60006101208b8352602060018060a01b038c16818501528160408501526137d48285018c61350d565b915083820360608501526137e8828b6130fb565b915083820360808501528189518084528284019150828160051b850101838c0160005b8381101561383957601f19878403018552613827838351612a21565b9486019492509085019060010161380b565b505086810360a088015261384d818c613547565b9450505050508560c08401528460e08401528281036101008401526138728185612a21565b9c9b505050505050505050505050565b60006020828403121561389457600080fd5b5051919050565b808202811582820484141761096257610962613477565b634e487b7160e01b600052601260045260246000fd5b6000826138e557634e487b7160e01b600052601260045260246000fd5b500490565b828152604060208201526000610e2b6040830184612a2156fea26469706673582212207b91156eb63c2f754499e70348fff8243421064b21c2a451c569fb40e301a7d664736f6c63430008180033`;

export const registrySourceCode = `// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";
import "@openzeppelin/contracts/governance/IGovernor.sol";

contract AWBRegistry is ERC721, ERC721URIStorage {
    // agent is a service that can be requested to perform a task
    struct Agent {
        uint256 id;
        address daoGovernor;
        address daoToken;
        string tokenURI;
        uint256 runPrice;
        uint256[] requestIds;
        bool active;
    }

    // request to an agent.  Picked up by fulfillers off-chain and fulfilled on-chain and off-chain
    struct Request {
        uint256 id;
        uint256 agentId;
        address origin;
        string request;
        bool fulfilled;
        string result;
        string resultURI;
        uint256 price;
        address fulfiller;
    }

    struct User {
        address userAddress;
        uint256[] requestIds;
        // TODO: address[] whitelistedFulfillers;
    }

    // fulfillers are addresses permissioned to fulfill requests (allowing for off-chain requests)
    struct Fulfiller {
        string name;
        string description;
        address fulfillerAddress;
        uint256[] requestIds;
    }

    uint256 private _nextTokenId;
    uint256 private _nextRequestId;

    mapping(uint256 => Agent) public agentIdToAgent;
    mapping(address => Agent) public daoGovernorToAgent;
    mapping(uint256 => Request) public requestIdToRequest;
    mapping(address => User) public addressToUser;
    mapping(address => Fulfiller) public fulfillerAddressToFulfiller;

    mapping(address => uint256) public balances;

    Agent[] public agents;
    Request[] public requests;
    User[] public users;
    Fulfiller[] public fulfillers;

    constructor(
        string memory _name,
        string memory _symbol
    ) ERC721(_name, _symbol) {}

    // register an agent with the registry. Mints a new NFT and stores the agent data
    function registerAgent(
        address _daoToken,
        string memory _tokenURI,
        uint256 _runPrice
    ) public {
        // require the sender to not have an active agent
        require(
            daoGovernorToAgent[msg.sender].active == false,
            "You have an active agent"
        );

        uint256 tokenId = _nextTokenId++;

        _safeMint(msg.sender, tokenId);
        _setTokenURI(tokenId, _tokenURI);

        Agent memory agent = Agent({
            id: tokenId,
            daoGovernor: msg.sender,
            daoToken: _daoToken,
            tokenURI: _tokenURI,
            runPrice: _runPrice,
            requestIds: new uint256[](0),
            active: true
        });

        agentIdToAgent[tokenId] = agent;
        daoGovernorToAgent[msg.sender] = agent;
        agents.push(agent);
    }

    // register as a user with the registry
    function registerUser() public payable {
        require(
            addressToUser[msg.sender].userAddress == address(0),
            "User already exists"
        );

        User memory user = User({
            userAddress: msg.sender,
            requestIds: new uint256[](0)
        });

        addressToUser[msg.sender] = user;
        users.push(user);
    }

    // register as a fulfiller with the registry
    function registerFulfiller(
        string memory _name,
        string memory _description
    ) public {
        require(
            fulfillerAddressToFulfiller[msg.sender].fulfillerAddress ==
                address(0),
            "Fulfiller already exists"
        );

        Fulfiller memory fulfiller = Fulfiller({
            name: _name,
            description: _description,
            fulfillerAddress: msg.sender,
            requestIds: new uint256[](0)
        });

        fulfillerAddressToFulfiller[msg.sender] = fulfiller;
        fulfillers.push(fulfiller);
    }

    // make a request to an agent
    function submitRequest(
        uint256 _agentId,
        string memory _request,
        address _origin
    ) public {
        // only fulfillers can submit requests on behalf of others
        if (
            fulfillerAddressToFulfiller[msg.sender].fulfillerAddress ==
            address(0)
        ) {
            _origin = msg.sender;
        }

        Agent memory agent = agentIdToAgent[_agentId];
        require(agent.active == true, "Agent is not active");

        uint256 runPrice = agent.runPrice;

        require(balances[_origin] >= runPrice, "Insufficient balance");

        uint256 requestId = _nextRequestId++;

        Request memory request = Request({
            id: requestId,
            agentId: _agentId,
            origin: _origin,
            request: _request,
            fulfilled: false,
            result: "",
            resultURI: "",
            price: runPrice,
            fulfiller: address(0)
        });

        requestIdToRequest[requestId] = request;
        requests.push(request);

        agentIdToAgent[_agentId].requestIds.push(requestId);
        addressToUser[_origin].requestIds.push(requestId);
    }

    function fulfillRequest(
        uint256 _requestId,
        string memory _result,
        string memory _resultURI
    ) public {
        Request storage request = requestIdToRequest[_requestId];

        // Check if the request exists and is not yet fulfilled
        require(request.id == _requestId, "Request does not exist");
        require(!request.fulfilled, "Request already fulfilled");

        // Check if the caller is a registered fulfiller
        require(
            fulfillerAddressToFulfiller[msg.sender].fulfillerAddress ==
                msg.sender,
            "Caller is not a fulfiller"
        );

        // Calculate request price and apply holder discount if applicable
        uint256 requestPrice = agentIdToAgent[request.agentId].runPrice;
        bool holderDiscountEnabled = IERC20(
            agentIdToAgent[request.agentId].daoToken
        ).balanceOf(request.origin) > 0;
        if (holderDiscountEnabled) {
            // 50% discount for token holders
            requestPrice = requestPrice / 2;
        }

        // Check if the requester has sufficient balance
        require(
            balances[request.origin] >= requestPrice,
            "Insufficient balance"
        );

        // Deduct the price from the requester's balance
        balances[request.origin] -= requestPrice;

        // Fulfill the request
        request.fulfilled = true;
        request.result = _result;
        request.resultURI = _resultURI;
        request.fulfiller = msg.sender;

        // Update mappings
        requestIdToRequest[_requestId] = request;
        requests[request.id] = request;
        fulfillerAddressToFulfiller[msg.sender].requestIds.push(request.id);

        if (holderDiscountEnabled) {
            // Send the whole price to the fulfiller
            balances[msg.sender] += requestPrice;
        } else {
            // send 50/50
            balances[msg.sender] += requestPrice / 2;
            balances[agentIdToAgent[request.agentId].daoGovernor] +=
                requestPrice /
                2;
        }
    }

    // create and fulfill a request in one transaction (for fullfullers to fulfill off-chain requests)
    function createAndFulfillRequest(
        uint256 _agentId,
        address _origin,
        string memory _request,
        string memory _result,
        string memory _resultURI
    ) public {
        submitRequest(_agentId, _request, _origin);
        fulfillRequest(_nextRequestId - 1, _result, _resultURI);
    }

    // deposit ETH into the registry
    function deposit() public payable {
        balances[msg.sender] += msg.value;
    }

    // withdraw ETH from the registry
    function withdraw(uint256 _amount) public {
        require(balances[msg.sender] >= _amount, "Insufficient balance");
        balances[msg.sender] -= _amount;
        payable(msg.sender).transfer(_amount);
    }

    // getters
    function getAllAgents() public view returns (Agent[] memory) {
        return agents;
    }

    function getAllRequests() public view returns (Request[] memory) {
        return requests;
    }

    function getAllUsers() public view returns (User[] memory) {
        return users;
    }

    function getAllFulfillers() public view returns (Fulfiller[] memory) {
        return fulfillers;
    }

    function getAgentById(uint256 _id) public view returns (Agent memory) {
        return agentIdToAgent[_id];
    }

    function getRequestById(uint256 _id) public view returns (Request memory) {
        return requestIdToRequest[_id];
    }

    function getUserByAddress(
        address _address
    ) public view returns (User memory) {
        return addressToUser[_address];
    }

    function getFulfillerByAddress(
        address _address
    ) public view returns (Fulfiller memory) {
        return fulfillerAddressToFulfiller[_address];
    }

    ///////////////////////////////////
    // ERC721 with managed tokenURIs //
    //////////////////////////////////
    function safeMint(address to, string memory uri) internal {
        uint256 tokenId = _nextTokenId++;
        _safeMint(to, tokenId);
        _setTokenURI(tokenId, uri);
    }

    function updateTokenURI(uint256 tokenId, string memory uri) public {
        require(
            ownerOf(tokenId) == msg.sender,
            "Caller is not the token owner"
        );
        _setTokenURI(tokenId, uri);
        agentIdToAgent[tokenId].tokenURI = uri;
    }

    // The following functions are overrides required by Solidity.

    function tokenURI(
        uint256 tokenId
    ) public view override(ERC721, ERC721URIStorage) returns (string memory) {
        return super.tokenURI(tokenId);
    }

    function supportsInterface(
        bytes4 interfaceId
    ) public view override(ERC721, ERC721URIStorage) returns (bool) {
        return super.supportsInterface(interfaceId);
    }
}
`;
